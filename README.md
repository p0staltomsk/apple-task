# apple-task
just task

https://github.com/p0staltomsk/apple-task

Задача:

(DONE ->)
Установить advanced шаблон Yii2 фреймворка, **в backend-приложении реализовать** следующий закрытый функционал 
(доступ в backend-приложение должен производиться **только по паролю** (!), сложного разделения прав не требуется): 

Написать класс/объект Apple с хранением яблок в БД MySql следуя ООП парадигме.

**Реализовать кнопки, формы, соответствующие функции:**

На странице в приложении должны быть отображены все яблоки, (view)
которые на этой же странице можно сгенерировать (инициализация дерева) в случайном кол-ве соответствующей кнопкой.

Рядом с каждым яблоком должны быть меню, статусы, функции (уронить, съесть, процент количества).
(<-DONE)

План действий:

1) Структура БД сразу через миграции (https://www.yiiframework.com/doc/guide/2.0/ru/db-migrations)
2) Написание кода/класса/логики приложения

=== Инструкция по установке ===

(1) Install migrations:

    m191024_102020_push_active_user - активный пользователь (apple-admin)
    m191024_112713_create_apples_table - таблица яблок
    m191024_113408_create_colors_table - таблица цветов яблок
    m191024_113810_create_status_table - таблица статусов яблок
    
(2) Password для apple-admin: 

    123123

=== Комментарии p0stal.tomsk ===

Описание алгоритма и элементы креатива:

    1) Иконку для приложения (favicon) нарисовала дочка, подправил в https://www.favicon.cc
    2) Черные яблоки считаются неудачно рожденными или полностью сгнившими (удаляются автоматически на главном экране приложения)
    3) Созданное вручную абстрактное яблоко ($apple = new Apple('green')) не записывается в БД, 
        но может быть осмотренно (echo $apple->color, echo $apple->size), 
        откушенно частично или съедено ($apple->eat(50), $apple->eatAll()) 
        независимо от статуса (на дереве или на земле)
    4) Созданное вручную яблоко может быть сохраненно на текущем дереве, через метод $apple->saveAbstractAppleToTree();
    5) Рандомное яблоко для генератора дерева (\app\models\Apples::generation), создаётся через метод $apple->newApple();

Замечания к реализации:

    Избыточным показалось использовать в рамках задания валидацию данных, ограничился ForeignKey (RESTRICT) для связанных полей.
    Не слишком удачно используется виджет ActiveForm - всего лишь выводит кнопки которые можно было воткнуть в view статикой, но в потенциале формы нужны на проекте для ajax запросов и т.п.

=== Функционал ===

Функции (AppleController)

    - инициализация дерева (рандом) (DONE ✓)
    - пропустить час    
    - упасть
    - съесть ($percent - процент откушенной части)
    - удалить (когда полностью съедено)

Переменные (свойства объекта)

    - цвет (устанавливается при создании объекта случайным) (DONE ✓)
    - дата появления (устанавливается при создании объекта случайным unixTmeStamp) (DONE ✓)
    - дата падения (устанавливается при падении объекта с дерева)
    - статус (на дереве / упало / испорченно) (DONE ✓)
    - сколько съели (%)
    - другие необходимые переменные, для определения состояния.

Состояния (status)

    - висит на дереве (DONE ✓)
    - упало/лежит на земле (DONE ✓)
    - гнилое яблоко (DONE ✓)

Условия (Алгоритм)

    Пока висит на дереве - испортиться не может. (статусы)
    Когда висит на дереве - съесть не получится. (статусы)
    После лежания 5 часов - портится. (статус + dateFalls)
    Когда испорчено - съесть не получится. (статус + исключение в функции)
    Когда съедено - удаляется из массива яблок. (size == 0)

Пример результирующего скрипта:

    $apple = new Apple('green'); // (функция - создать яблоко) возможность создать яблоко нужного цвета, по умолчанию зеленое (DONE ✓)
        echo $apple->color; // green (функция - осмотреть цвет яблока)
            
    $apple->eat(50); // (функция - откусить пол яблока) 
        // Бросить исключение - Съесть нельзя, если яблоко на дереве.
        echo $apple->size; // 1 - decimal (функция - осмотреть количество яблока)
        
    $apple->fallToGround(); // (функция) уронить яблоко на землю
    $apple->eat(25); // (функция) откусить четверть яблока
        echo $apple->size; // 0,75 (функция - осмотреть количество яблока)
